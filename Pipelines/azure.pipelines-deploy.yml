trigger: none

resources:
  pipelines:
  - pipeline: validation
    source: Nabanita-Sahu.Validate  # Must match the pipeline name exactly
    project: PipelineDemo
    branch: main
    trigger: true  # Automatically trigger deploy after validation succeeds

pool:
  name: DevOpsPracticePool

stages:
- stage: Deploy
  displayName: "Deploy Stage"
  jobs:
  - job: DeployJob
    displayName: "Deploy Application"
    steps:

    - task: DownloadPipelineArtifact@2
      displayName: "Download build artifacts"
      inputs:
        source: validation
        artifact: drop
        path: $(Pipeline.Workspace)

    - script: |
        echo "Starting deployment..."

        set ARTIFACT_PATH="$(Pipeline.Workspace)\drop"

        echo Checking for artifact at: %ARTIFACT_PATH%

        if exist %ARTIFACT_PATH% (
            echo Artifact 'drop' found at: %ARTIFACT_PATH%
            echo Deploying application...
            REM Add actual deployment commands here
        ) else (
            echo Artifact 'drop' not found. Skipping deployment.
            exit /b 1
        )
      displayName: "Deployment Step"